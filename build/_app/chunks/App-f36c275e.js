import{M as e,N as t,O as s,P as i,Q as n,R as a,V as o,T as r,U as h,W as c,X as l,Y as d,Z as p,_ as m}from"./vendor-5dea8d44.js";const w=1/3*Math.PI,y=180*Math.sin(w),M=Math.asin(y/270),f=(180*Math.cos(w)+270*Math.cos(M))/2,g=Math.acos(f/180),P=Math.acos(f/270);const u=[16711782,65382,16737792];function v(){const e=new s,t=I();t.position.x=-18,e.add(t);const r=I();r.position.z=6,r.position.x=18,e.add(r);const h=new i(new n(60,30,15),new a({color:(c=u,c[Math.floor(Math.random()*c.length)])}));var c;h.position.z=12,e.add(h);const l=S();l.center=new o(.5,.5),l.rotation=-Math.PI/2;const d=S();d.center=new o(.5,.5),l.rotation=Math.PI/2;const p=b(),m=b();m.flipY=!1;const w=new i(new n(33,24,12),[new a({map:l}),new a({map:d}),new a({map:m}),new a({map:p}),new a({color:16777215}),new a({color:16777215})]);return w.position.x=-6,w.position.z=25.5,e.add(w),e}function I(){const e=new i(new n(12,33,12),new a({color:3355443}));return e.position.z=6,e}function S(){const t=document.createElement("canvas");t.width=64,t.height=32;const s=t.getContext("2d");return s.fillStyle="#ffffff",s.fillRect(0,0,64,32),s.fillStyle="#666666",s.fillRect(8,8,48,24),new e(t)}function b(){const t=document.createElement("canvas");t.width=128,t.height=32;const s=t.getContext("2d");return s.fillStyle="#ffffff",s.fillRect(0,0,128,32),s.fillStyle="#666666",s.fillRect(10,8,38,24),s.fillRect(58,8,60,24),new e(t)}class k{constructor(){this.initThree(),this.scoreElement=document.getElementById("score"),this.resetElement=document.getElementById("reset"),this.otherVehicles=[],this.reset(),this.accelerate=!1,this.decelerate=!1}animation(e){if(!this.lastTimeStamp)return void(this.lastTimeStamp=e);const t=e-this.lastTimeStamp;this.movePlayerCar(t);const s=Math.floor(Math.abs(this.playerAngleMoved)/(2*Math.PI));s!=this.score&&(this.score=s,this.scoreElement.innerText=this.score),this.otherVehicles.length<=(s+1)/5&&this.addVehicle(),this.moveOtherVehicles(t),this.hitDetection(),this.renderer.render(this.scene,this.camera),this.lastTimeStamp=e}movePlayerCar(e){this.baseSpeed=.0017,this.playerSpeed=this.getPlayerSpeed(),this.playerAngleMoved-=this.playerSpeed*e;const t=this.playerAngleInitial+this.playerAngleMoved,s=225*Math.cos(t)-f,i=225*Math.sin(t);this.playerCar.position.x=s,this.playerCar.position.y=i,this.playerCar.rotation.z=t-Math.PI/2}getPlayerSpeed(){return this.accelerate?2*this.baseSpeed:this.decelerate?.5*this.baseSpeed:this.baseSpeed}addVehicle(){const e=v();this.scene.add(e);const t=Math.random()>=.5,s=t?Math.PI/2:-Math.PI/2;const i=1+1*Math.random();this.otherVehicles.push({mesh:e,clockwise:t,angle:s,speed:i})}moveOtherVehicles(e){const t=.0017;this.otherVehicles.forEach((s=>{s.clockwise?s.angle-=t*e*s.speed:s.angle+=t*e*s.speed;const i=225*Math.cos(s.angle)+f,n=225*Math.sin(s.angle),a=s.angle+(s.clockwise?-Math.PI/2:Math.PI/2);s.mesh.position.x=i,s.mesh.position.y=n,s.mesh.rotation.z=a}))}getHitZonePosition(e,t,s,i){const n=t+s?-Math.PI/2:Math.PI/2;return{x:e.x+Math.cos(n)*i,y:e.y+Math.sin(n)*i}}getDistance(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}hitDetection(){const e=this.getHitZonePosition(this.playerCar.position,this.playerAngleInitial+this.playerAngleMoved,!0,15),t=this.getHitZonePosition(this.playerCar.position,this.playerAngleInitial+this.playerAngleMoved,!0,-15);this.otherVehicles.some((s=>{const i=this.getHitZonePosition(s.mesh.position,s.angle,s.clockwise,15),n=this.getHitZonePosition(s.mesh.position,s.angle,s.clockwise,-15);return this.getDistance(e,i)<40||(this.getDistance(t,n)<40||(this.getDistance(t,i)<40||void 0))}))&&(this.resetElement.style.display="block",this.renderer.setAnimationLoop(null),window.removeEventListener("keydown"))}startGame(){this.ready&&(this.ready=!1,this.renderer.setAnimationLoop(this.animation.bind(this)))}reset(){window.addEventListener("keydown",(e=>"ArrowUp"==e.key?(this.startGame(),void(this.accelerate=!0)):"ArrowDown"!=e.key?"R"==e.key||"r"==e.key?(this.reset(),void(this.resetElement.style.display="none")):void 0:void(this.decelerate=!0))),window.addEventListener("keyup",(e=>{"ArrowUp"!=e.key?"ArrowDown"!=e.key||(this.decelerate=!1):this.accelerate=!1})),this.playerAngleMoved=0,this.playerAngleInitial=Math.PI,this.playerSpeed=.0017,this.movePlayerCar(0),this.score=0,this.scoreElement.innerText=this.score,this.lastTimeStamp=void 0,this.otherVehicles.forEach((e=>{this.scene.remove(e.mesh)})),this.otherVehicles=[],this.renderer.render(this.scene,this.camera),this.ready=!0}renderMap(s,n){const o=function(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const n=i.getContext("2d");return n.fillStyle="#546e90",n.fillRect(0,0,t,s),n.lineWidth=2,n.strokeStyle="#e0ffff",n.setLineDash([10,14]),n.beginPath(),n.arc(t/2-f,s/2,225,0,2*Math.PI),n.stroke(),n.beginPath(),n.arc(t/2+f,s/2,225,0,2*Math.PI),n.stroke(),new e(i)}(s,n),c=new r(s,n),l=new a({color:5533328,map:o}),d=new i(c,l);this.scene.add(d);const p=function(){const e=new t;return e.absarc(-f,0,180,w,-w,!1),e.absarc(f,0,270,Math.PI+M,Math.PI-M,!0),e}(),m=function(){const e=new t;return e.absarc(f,0,180,Math.PI-w,Math.PI+w,!0),e.absarc(-f,0,270,-M,M,!1),e}(),y=function(){const e=new t;return e.absarc(-f,0,180,g,-g,!0),e.absarc(f,0,180,Math.PI+g,Math.PI-g,!0),e}(),u=function(e,s){const i=new t;return i.moveTo(-e/2,-s/2),i.lineTo(0,-s/2),i.absarc(-f,0,270,-P,P,!0),i.absarc(f,0,270,Math.PI-P,Math.PI+P,!0),i.lineTo(0,-s/2),i.lineTo(e/2,-s/2),i.lineTo(e/2,s/2),i.lineTo(-e/2,s/2),i}(s,n),v=new h([p,y,m,u],{depth:6,bevelEnabled:!1}),I=new i(v,[new a({color:6799936}),new a({color:2306332})]);this.scene.add(I)}initThree(){this.scene=new c,this.playerCar=v(),this.scene.add(this.playerCar);const e=new l(16777215,.6);this.scene.add(e);const t=new d(16777215,.6);t.position.set(0,0,200),this.scene.add(t);const s=960,i=s/(window.innerWidth/window.innerHeight);this.camera=new p(-480,480,i/2,i/-2,0,1e3),this.camera.position.set(0,-210,300),this.camera.lookAt(0,0,0),this.renderMap(s,2*i),this.renderer=new m({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.render(this.scene,this.camera),document.body.appendChild(this.renderer.domElement)}}export{k as A};
