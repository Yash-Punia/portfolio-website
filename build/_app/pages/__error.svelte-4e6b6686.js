import{F as e,G as t,H as s,M as a,I as n,J as i,V as o,P as r,K as h,L as c,N as l,O as d,Q as p,W as m,S as w,i as f,s as y,R as g,T as v,U as M,e as u,t as P,k as I,j as E,c as x,a as S,g as b,d as k,n as A,m as V,b as D,f as T,X as $,o as C,Y as R,v as z,r as H,w as L,z as Z}from"../chunks/vendor-e92375a5.js";const W=1/3*Math.PI,G=180*Math.sin(W),O=Math.asin(G/270),U=(180*Math.cos(W)+270*Math.cos(O))/2,j=Math.acos(U/180),B=Math.acos(U/270);const Y=[16711782,65382,16737792];function q(){const e=new s,t=F();t.position.x=-18,e.add(t);const r=F();r.position.z=6,r.position.x=18,e.add(r);const h=new a(new n(60,30,15),new i({color:(c=Y,c[Math.floor(Math.random()*c.length)])}));var c;h.position.z=12,e.add(h);const l=J();l.center=new o(.5,.5),l.rotation=-Math.PI/2;const d=J();d.center=new o(.5,.5),l.rotation=Math.PI/2;const p=K(),m=K();m.flipY=!1;const w=new a(new n(33,24,12),[new i({map:l}),new i({map:d}),new i({map:m}),new i({map:p}),new i({color:16777215}),new i({color:16777215})]);return w.position.x=-6,w.position.z=25.5,e.add(w),e}function F(){const e=new a(new n(12,33,12),new i({color:3355443}));return e.position.z=6,e}function J(){const t=document.createElement("canvas");t.width=64,t.height=32;const s=t.getContext("2d");return s.fillStyle="#ffffff",s.fillRect(0,0,64,32),s.fillStyle="#666666",s.fillRect(8,8,48,24),new e(t)}function K(){const t=document.createElement("canvas");t.width=128,t.height=32;const s=t.getContext("2d");return s.fillStyle="#ffffff",s.fillRect(0,0,128,32),s.fillStyle="#666666",s.fillRect(10,8,38,24),s.fillRect(58,8,60,24),new e(t)}class N{constructor(){this.initThree(),this.scoreElement=document.getElementById("score"),this.resetElement=document.getElementById("reset"),this.otherVehicles=[],this.reset(),this.accelerate=!1,this.decelerate=!1}animation(e){if(!this.lastTimeStamp)return void(this.lastTimeStamp=e);const t=e-this.lastTimeStamp;this.movePlayerCar(t);const s=Math.floor(Math.abs(this.playerAngleMoved)/(2*Math.PI));s!=this.score&&(this.score=s,this.scoreElement.innerText=this.score),this.otherVehicles.length<=(s+1)/5&&this.addVehicle(),this.moveOtherVehicles(t),this.hitDetection(),this.renderer.render(this.scene,this.camera),this.lastTimeStamp=e}movePlayerCar(e){this.baseSpeed=.0017,this.playerSpeed=this.getPlayerSpeed(),this.playerAngleMoved-=this.playerSpeed*e;const t=this.playerAngleInitial+this.playerAngleMoved,s=225*Math.cos(t)-U,a=225*Math.sin(t);this.playerCar.position.x=s,this.playerCar.position.y=a,this.playerCar.rotation.z=t-Math.PI/2}getPlayerSpeed(){return this.accelerate?2*this.baseSpeed:this.decelerate?.5*this.baseSpeed:this.baseSpeed}addVehicle(){const e=q();this.scene.add(e);const t=Math.random()>=.5,s=t?Math.PI/2:-Math.PI/2;const a=1+1*Math.random();this.otherVehicles.push({mesh:e,clockwise:t,angle:s,speed:a})}moveOtherVehicles(e){const t=.0017;this.otherVehicles.forEach((s=>{s.clockwise?s.angle-=t*e*s.speed:s.angle+=t*e*s.speed;const a=225*Math.cos(s.angle)+U,n=225*Math.sin(s.angle),i=s.angle+(s.clockwise?-Math.PI/2:Math.PI/2);s.mesh.position.x=a,s.mesh.position.y=n,s.mesh.rotation.z=i}))}getHitZonePosition(e,t,s,a){const n=t+s?-Math.PI/2:Math.PI/2;return{x:e.x+Math.cos(n)*a,y:e.y+Math.sin(n)*a}}getDistance(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}hitDetection(){const e=this.getHitZonePosition(this.playerCar.position,this.playerAngleInitial+this.playerAngleMoved,!0,15),t=this.getHitZonePosition(this.playerCar.position,this.playerAngleInitial+this.playerAngleMoved,!0,-15);this.otherVehicles.some((s=>{const a=this.getHitZonePosition(s.mesh.position,s.angle,s.clockwise,15),n=this.getHitZonePosition(s.mesh.position,s.angle,s.clockwise,-15);return this.getDistance(e,a)<40||(this.getDistance(t,n)<40||(this.getDistance(t,a)<40||void 0))}))&&(this.resetElement.style.display="block",this.renderer.setAnimationLoop(null),window.removeEventListener("keydown"))}startGame(){this.ready&&(this.ready=!1,this.renderer.setAnimationLoop(this.animation.bind(this)))}reset(){window.addEventListener("keydown",(e=>"ArrowUp"==e.key?(this.startGame(),void(this.accelerate=!0)):"ArrowDown"!=e.key?"R"==e.key||"r"==e.key?(this.reset(),void(this.resetElement.style.display="none")):void 0:void(this.decelerate=!0))),window.addEventListener("keyup",(e=>{"ArrowUp"!=e.key?"ArrowDown"!=e.key||(this.decelerate=!1):this.accelerate=!1})),this.playerAngleMoved=0,this.playerAngleInitial=Math.PI,this.playerSpeed=.0017,this.movePlayerCar(0),this.score=0,this.scoreElement.innerText=this.score,this.lastTimeStamp=void 0,this.otherVehicles.forEach((e=>{this.scene.remove(e.mesh)})),this.otherVehicles=[],this.renderer.render(this.scene,this.camera),this.ready=!0}renderMap(s,n){const o=function(t,s){const a=document.createElement("canvas");a.width=t,a.height=s;const n=a.getContext("2d");return n.fillStyle="#546e90",n.fillRect(0,0,t,s),n.lineWidth=2,n.strokeStyle="#e0ffff",n.setLineDash([10,14]),n.beginPath(),n.arc(t/2-U,s/2,225,0,2*Math.PI),n.stroke(),n.beginPath(),n.arc(t/2+U,s/2,225,0,2*Math.PI),n.stroke(),new e(a)}(s,n),c=new r(s,n),l=new i({color:5533328,map:o}),d=new a(c,l);this.scene.add(d);const p=function(){const e=new t;return e.absarc(-U,0,180,W,-W,!1),e.absarc(U,0,270,Math.PI+O,Math.PI-O,!0),e}(),m=function(){const e=new t;return e.absarc(U,0,180,Math.PI-W,Math.PI+W,!0),e.absarc(-U,0,270,-O,O,!1),e}(),w=function(){const e=new t;return e.absarc(-U,0,180,j,-j,!0),e.absarc(U,0,180,Math.PI+j,Math.PI-j,!0),e}(),f=function(e,s){const a=new t;return a.moveTo(-e/2,-s/2),a.lineTo(0,-s/2),a.absarc(-U,0,270,-B,B,!0),a.absarc(U,0,270,Math.PI-B,Math.PI+B,!0),a.lineTo(0,-s/2),a.lineTo(e/2,-s/2),a.lineTo(e/2,s/2),a.lineTo(-e/2,s/2),a}(s,n),y=new h([p,w,m,f],{depth:6,bevelEnabled:!1}),g=new a(y,[new i({color:6799936}),new i({color:2306332})]);this.scene.add(g)}initThree(){this.scene=new c,this.playerCar=q(),this.scene.add(this.playerCar);const e=new l(16777215,.6);this.scene.add(e);const t=new d(16777215,.6);t.position.set(0,0,200),this.scene.add(t);const s=960,a=s/(window.innerWidth/window.innerHeight);this.camera=new p(-480,480,a/2,a/-2,0,1e3),this.camera.position.set(0,-210,300),this.camera.lookAt(0,0,0),this.renderMap(s,2*a),this.renderer=new m({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.render(this.scene,this.camera),document.body.appendChild(this.renderer.domElement)}}function Q(e){let t,s,a,n,i,o,r,h,c,l,d,p,m,w,f,y,Z,W,G,O;return o=new g({props:{data:v,scale:"4"}}),p=new g({props:{data:M,scale:"4"}}),{c(){t=u("div"),s=P("0"),a=I(),n=u("div"),i=u("div"),E(o.$$.fragment),r=I(),h=u("p"),c=P("Accelerate"),l=I(),d=u("div"),E(p.$$.fragment),m=I(),w=u("p"),f=P("Decelerate"),y=I(),Z=u("div"),W=u("p"),G=P("Press 'R' to reset game"),this.h()},l(e){t=x(e,"DIV",{id:!0,class:!0});var g=S(t);s=b(g,"0"),g.forEach(k),a=A(e),n=x(e,"DIV",{class:!0});var v=S(n);i=x(v,"DIV",{class:!0});var M=S(i);V(o.$$.fragment,M),r=A(M),h=x(M,"P",{class:!0});var u=S(h);c=b(u,"Accelerate"),u.forEach(k),M.forEach(k),l=A(v),d=x(v,"DIV",{class:!0});var P=S(d);V(p.$$.fragment,P),m=A(P),w=x(P,"P",{class:!0});var I=S(w);f=b(I,"Decelerate"),I.forEach(k),P.forEach(k),v.forEach(k),y=A(e),Z=x(e,"DIV",{id:!0,class:!0});var E=S(Z);W=x(E,"P",{class:!0});var D=S(W);G=b(D,"Press 'R' to reset game"),D.forEach(k),E.forEach(k),this.h()},h(){D(t,"id","score"),D(t,"class","svelte-1hh30x"),D(h,"class","svelte-1hh30x"),D(i,"class","up svelte-1hh30x"),D(w,"class","svelte-1hh30x"),D(d,"class","down svelte-1hh30x"),D(n,"class","container controls svelte-1hh30x"),D(W,"class","svelte-1hh30x"),D(Z,"id","reset"),D(Z,"class","container reset svelte-1hh30x")},m(e,g){T(e,t,g),$(t,s),T(e,a,g),T(e,n,g),$(n,i),C(o,i,null),$(i,r),$(i,h),$(h,c),$(n,l),$(n,d),C(p,d,null),$(d,m),$(d,w),$(w,f),T(e,y,g),T(e,Z,g),$(Z,W),$(W,G),O=!0},p:R,i(e){O||(z(o.$$.fragment,e),z(p.$$.fragment,e),O=!0)},o(e){H(o.$$.fragment,e),H(p.$$.fragment,e),O=!1},d(e){e&&k(t),e&&k(a),e&&k(n),L(o),L(p),e&&k(y),e&&k(Z)}}}function X(e){return Z((()=>{window.focus();const e=new N;window.app=e})),[]}export default class extends w{constructor(e){super(),f(this,e,X,Q,y,{})}}
